<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Docker for Windows | Notes, Thoughts, and Adventures</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Docker for Windows" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="There are two options to support running Linux containers on Windows; Docker Desktop and Docker under WSL2. Docker Desktop may require a subscription for business use. However, it is easy to set up and run. In addition, it provides a simple way to work on Windows Containers. Here is an overview of the two:" />
<meta property="og:description" content="There are two options to support running Linux containers on Windows; Docker Desktop and Docker under WSL2. Docker Desktop may require a subscription for business use. However, it is easy to set up and run. In addition, it provides a simple way to work on Windows Containers. Here is an overview of the two:" />
<link rel="canonical" href="/wsl/2022/09/29/docker_wsl.html" />
<meta property="og:url" content="/wsl/2022/09/29/docker_wsl.html" />
<meta property="og:site_name" content="Notes, Thoughts, and Adventures" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-09-29T00:00:00-07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Docker for Windows" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-09-29T00:00:00-07:00","datePublished":"2022-09-29T00:00:00-07:00","description":"There are two options to support running Linux containers on Windows; Docker Desktop and Docker under WSL2. Docker Desktop may require a subscription for business use. However, it is easy to set up and run. In addition, it provides a simple way to work on Windows Containers. Here is an overview of the two:","headline":"Docker for Windows","mainEntityOfPage":{"@type":"WebPage","@id":"/wsl/2022/09/29/docker_wsl.html"},"url":"/wsl/2022/09/29/docker_wsl.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Notes, Thoughts, and Adventures" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Notes, Thoughts, and Adventures</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Docker for Windows</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2022-09-29T00:00:00-07:00" itemprop="datePublished">Sep 29, 2022
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>There are two options to support running Linux containers on Windows; Docker
Desktop and Docker under WSL2. Docker Desktop
<a href="https://www.docker.com/pricing/faq/">may require a subscription for business use</a>.
However, it is easy to set up and run. In addition, it provides a simple way
to work on Windows Containers. Here is an overview of the two:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Category</th>
      <th style="text-align: right">Docker Desktop</th>
      <th style="text-align: right">WSL2 Docker</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Resources</td>
      <td style="text-align: right">Light</td>
      <td style="text-align: right">Very Light</td>
    </tr>
    <tr>
      <td style="text-align: left">Availability</td>
      <td style="text-align: right">Global</td>
      <td style="text-align: right">Distro</td>
    </tr>
    <tr>
      <td style="text-align: left">Ease of Use</td>
      <td style="text-align: right">Easy</td>
      <td style="text-align: right">Moderate</td>
    </tr>
    <tr>
      <td style="text-align: left">License</td>
      <td style="text-align: right"><a href="https://www.docker.com/pricing/faq/">Business - $</a></td>
      <td style="text-align: right">Free</td>
    </tr>
    <tr>
      <td style="text-align: left">Windows Containers</td>
      <td style="text-align: right">Yes</td>
      <td style="text-align: right">No</td>
    </tr>
  </tbody>
</table>

<h3 id="resources">Resources</h3>

<p>Both the Docker Desktop and the WSL2 Docker are light on resources. Take,
for example, my oldest machine, the 1st generation Surface Pro. With a humble
4GB of RAM, I can build and run containers, have an instance of WSL2 running for
development, VS Code, and still squeeze in several browser tabs. That said,
WSL2 Docker gets a slight lead here, as there is no desktop client or additional
WSL2 distros that need to run.</p>

<p>The startup time for Docker Desktop is a lot longer than WSL2 Docker. It took
over a minute for Docker Desktop to start. Half of that time was bringing up the
application, and the other half was waiting for the docker icon in the system
tray to indicate it was ready. Compare that to WSL2 Docker, which started in
less than 5 seconds. That time also includes bringing up the WSL2 distro as
well.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Engine</th>
      <th style="text-align: right">Startup Time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Docker Desktop</td>
      <td style="text-align: right">68s</td>
    </tr>
    <tr>
      <td style="text-align: left">WSL2 Docker</td>
      <td style="text-align: right">3.54s</td>
    </tr>
  </tbody>
</table>

<p>Once things are up and running, performance becomes similar between the two.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Operation</th>
      <th style="text-align: right">Docker Desktop</th>
      <th style="text-align: right">WSL2 Docker</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">split 50k files</td>
      <td style="text-align: right">6.87s</td>
      <td style="text-align: right">4.07s</td>
    </tr>
    <tr>
      <td style="text-align: left">rm 50k files</td>
      <td style="text-align: right">2.66s</td>
      <td style="text-align: right">2.05s</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>Benchmarks performed on a 1st generation Surface Pro with 64GB SSD. Your
results will see improvement with better hardware.</p>
</blockquote>

<h3 id="availability">Availability</h3>

<p>When Docker Desktop is installed, the client is available in the Windows
Console, under both the Command Prompt and PowerShell. It can also be added to
any WSL2 distro with a few clicks in the desktop app. There is no need to
install the client for that distro; Docker will stub out everything in it with a
single click.</p>

<p><img src="/assets/docker_desktop_wsl_integration.png" alt="Docker Desktop WSL Integration" title="Docker Desktop WSL Integration" /></p>

<p>The WSL2 Docker will, by default, use <code class="language-plaintext highlighter-rouge">/var/run/docker.sock</code> in the distro. Only the
client on the same distro can use the Docker daemon.</p>

<h3 id="ease-of-use">Ease of Use</h3>

<p>Docker provides a desktop application to configure the Docker daemon and enable WSL
integration with other distros. In addition, it also gives a friendly visual interface
for managing images, containers, and volumes.</p>

<p>This is in contrast to WSL2 Docker, where you manage it as you would in Linux, via
the JSON configuration file <code class="language-plaintext highlighter-rouge">/etc/docker/daemon.json</code> and using the client
command-line interface (CLI) to handle container images, running containers, and
so forth.</p>

<h3 id="license">License</h3>

<p>Docker Desktop is free for businesses with less than 250 employees and $10
million in annual revenue at the time of this writing. Otherwise, it is a
minimum of $5 per month per user. Docker in WSL2 uses the open-source components
of Docker, such as containerd, and is free to use.</p>

<h3 id="windows-containers">Windows Containers</h3>

<p>For Docker Desktop, right-click the application in the system tray and
select <code class="language-plaintext highlighter-rouge">Switch to Windows Containers</code>. WSL2 Docker will only run Linux containers.</p>

<h2 id="docker-desktop">Docker Desktop</h2>

<p>Installing Docker Desktop is a piece of cake. They even provide a tutorial
once the application is running to guide you through running a container. See
https://docs.docker.com/desktop/windows/install/</p>

<p>Historically, Docker Desktop used to run a dedicated VM. Now, by default, it
runs on top of WSL2. Technically, it is still a VM but is highly optimized for
resource conservation. I evaluated it using a 1st gen Surface Pro with just 4GB
of RAM while having VS Code, a dozen tabs, and Spotify playing in the
background. The older dedicated VM implementation would require at decent chunk
of free memory to start it successfully, so the only way to launch Docker on 4GB
of RAM was after a reboot.</p>

<p>Docker Desktop installs two distros in WSL. One is <code class="language-plaintext highlighter-rouge">docker-desktop</code>, a
lightweight distro based on BusyBox that runs the Docker daemon and a host of
other processes. And <code class="language-plaintext highlighter-rouge">docker-desktop-data</code>, which contains what appears to be
cached build layers from built containers.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>wsl.exe <span class="nt">-l</span> <span class="nt">-v</span>
  NAME                   STATE           VERSION
<span class="k">*</span> Ubuntu                 Running         2
  docker-desktop-data    Running         2
  docker-desktop         Running         2
</code></pre></div></div>

<h3 id="cross-distro-support">Cross Distro Support</h3>

<p>When a WSL2 distro is integrated with Docker Desktop, it will run a process
called <code class="language-plaintext highlighter-rouge">docker-desktop-proxy</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ps aux | <span class="nb">grep </span>docker
root 5632  /wsl/docker-desktop/docker-desktop-proxy <span class="nt">--distro-name</span> Ubuntu <span class="nt">--docker-desktop-root</span> /wsl/docker-desktop
</code></pre></div></div>

<p>It will also set up <code class="language-plaintext highlighter-rouge">docker.sock</code> under <code class="language-plaintext highlighter-rouge">/var/run</code> and provide symbolic
links under <code class="language-plaintext highlighter-rouge">/usr/bin</code> programs like the docker client and docker-compose.</p>

<p>Lastly, it mounts directories between the Docker distros and your chosen distros,
under <code class="language-plaintext highlighter-rouge">/wsl</code>. This is, for now, an undocumented feature of WSL that Docker
Desktop utilizes. See WSL GitHub issues <a href="https://github.com/microsoft/WSL/issues/4577">#4577</a> and
<a href="https://github.com/microsoft/WSL/issues/5177">#5177</a> for further information.</p>

<p>This enables Docker Desktop to work across distros, using the same Docker daemon.</p>

<h2 id="docker-on-wsl2">Docker on WSL2</h2>

<p>Installing Docker in WSL2 is the same as it is under Linux. Update the
package tool to use Docker’s package repository and install all the needed
components that makeup Docker.</p>

<p><a href="https://docs.docker.com/engine/install/ubuntu/#install-using-the-repository">https://docs.docker.com/engine/install/ubuntu/#install-using-the-repository</a></p>

<p>In addition, you may want to add your user account to the docker group.</p>

<p><a href="https://docs.docker.com/engine/install/linux-postinstall/#manage-docker-as-a-non-root-user">https://docs.docker.com/engine/install/linux-postinstall/#manage-docker-as-a-non-root-user</a></p>

<p>With that, you should be all set with Docker in WSL2.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>service docker start
<span class="nv">$ </span>docker run hello-world

Hello from Docker!
This message shows that your installation appears to be working correctly.
...
</code></pre></div></div>

<h2 id="starting-docker-automatically">Starting Docker automatically</h2>

<p>If you are on Windows 11, you may be able to support <a href="https://devblogs.microsoft.com/commandline/systemd-support-is-now-available-in-wsl/">systemd for WSL2</a>.
You can use the same configuration as Linux to have
<a href="https://docs.docker.com/engine/install/linux-postinstall/#configure-docker-to-start-on-boot">Docker Start on boot</a>.</p>

<p>If <code class="language-plaintext highlighter-rouge">systemd</code> is not supported on your system, there is a quick way to have Docker start
when you log in to Windows.</p>

<p>First, get the distro name that you installed Docker on.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>wsl.exe <span class="nt">-l</span> <span class="nt">-v</span>
  NAME      STATE           VERSION
<span class="k">*</span> Ubuntu    Running         2
</code></pre></div></div>

<p>In my case, the distro name is <code class="language-plaintext highlighter-rouge">Ubuntu</code>. Open the Windows Run Dialog (WIN + R)
and enter <code class="language-plaintext highlighter-rouge">shell:startup</code>. The file explorer will open the startup folder for
your user account. Create a batch file such as <code class="language-plaintext highlighter-rouge">wsl_boot_script.bat</code> and add the
following to the script:</p>

<div class="language-batch highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">wsl</span> <span class="na">-d </span><span class="kd">Ubuntu</span> <span class="na">-u </span><span class="kd">root</span> <span class="na">-e </span><span class="kd">sudo</span> <span class="kd">service</span> <span class="kd">docker</span> <span class="nb">start</span>
</code></pre></div></div>

<p>And that’s it! Next time you log in to your Windows account, the script will start Docker.</p>

  </div><a class="u-url" href="/wsl/2022/09/29/docker_wsl.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Notes, Thoughts, and Adventures</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Notes, Thoughts, and Adventures</li><li><a class="u-email" href="mailto:82.phil@gmail.com">82.phil@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/82phil"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">82phil</span></a></li><li><a href="https://www.twitter.com/hoff_io"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">hoff_io</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>...</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
